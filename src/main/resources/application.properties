# ---------------- General ----------------
spring.application.name=user-service
spring.profiles.active=@activeSpringProfile@
spring.main.allow-bean-definition-overriding=true
spring.jpa.open-in-view=true
spring.jpa.hibernate.ddl-auto=none
spring.data.jpa.repositories.bootstrap-mode=default
spring.main.banner-mode=off
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration

# ---------------- Server ----------------
server.port=8082
server.host=http://localhost
app.base.url=http://localhost:8082

# Tomcat thread pool - Scaled for 5000 concurrent users
server.tomcat.threads.max=1000
server.tomcat.threads.min-spare=500
server.tomcat.max-connections=5000
server.tomcat.accept-count=1000
server.tomcat.connection-timeout=30000

# ---------------- CORS ----------------
registration.cors.allowed.origins=${REGISTRATION_CORS_ALLOWED_ORIGINS:}
registration.cors.allowed.paths=/service/users/askers/new,/service/users/consultants/languages

spring.web.locale=de_DE
spring.jackson.time-zone=Europe/Berlin

service.encryption.appkey=

# ---------------- User Workflows ----------------
user.account.deleteworkflow.cron=0 0 0 * * ?
user.anonymous.deleteworkflow.cron=0 0 * * * ?
user.anonymous.deleteworkflow.periodMinutes=2820
user.anonymous.deactivateworkflow.cron=0 0 * * * ?
user.anonymous.deactivateworkflow.periodMinutes=360
group.chat.deactivateworkflow.cron=0 0 * * * ?
group.chat.deactivateworkflow.periodMinutes=360

session.inactive.deleteWorkflow.enabled=false
session.inactive.deleteWorkflow.cron=0 0 2 * * ?
session.inactive.deleteWorkflow.check.days=30

user.registeredonly.deleteWorkflow.enabled=false
user.registeredonly.deleteWorkflow.cron=0 0 3 * * ?
user.registeredonly.deleteWorkflow.check.days=30
user.registeredonly.deleteWorkflow.afterSessionPurge.enabled=false

enquiry.open.notification.enabled=false
enquiry.open.notification.cron=0 7 * * * ?
enquiry.open.notification.check.hours=12

# ---------------- Identity Management ----------------
identity.email-dummy-suffix=@beratungcaritas.de
identity.technical-user.username=technical
identity.technical-user.password=technical
identity.error-message-duplicated-email=User exists with same email
identity.error-message-duplicated-username=User exists with same username
# Use Kubernetes DNS names, e.g., http://keycloak.caritas.svc.cluster.local:8080/realms/online-beratung/protocol/openid-connect
identity.openid-connect-url=${IDENTITY_OPENID_CONNECT_URL:}
identity.otp-url=${app.base.url}/auth/realms/online-beratung/otp-config
identity.otp-allowed-for-users=false
identity.otp-allowed-for-consultants=false
identity.otp-allowed-for-single-tenant-admins=false
identity.otp-allowed-for-restricted-agency-admins=false
identity.otp-allowed-for-tenant-super-admins=false
identity.display-name-allowed-for-consultants=false

# ---------------- API Docs ----------------
springfox.docuTitle=Caritas Online Beratung: UserService
springfox.docuDescription=Provides a REST API service to provide user information and actions.
springfox.docuVersion=0.0.1
springfox.docuTermsUrl=
springfox.docuContactName=
springfox.docuContactUrl=
springfox.docuContactEmail=
springfox.docuLicense=Apache 2.0
springfox.docuLicenseUrl=http://www.apache.org/licenses/LICENSE-2.0.html
springfox.docuPath=/users/docs
springdoc.swagger-ui.path=${springfox.docuPath}
springdoc.api-docs.path=/v3/api-docs

# ---------------- Rocket.Chat ----------------
# Use Kubernetes DNS names, e.g., http://rocketchat.caritas.svc.cluster.local:3000/api/v1
# MongoDB URL: mongodb://mongodb.caritas.svc.cluster.local:27017/rocketchat?retryWrites=false
rocket-chat.credential-cron=0 0 * * * ?
rocket-chat.base-url=${ROCKET_CHAT_BASE_URL:}
rocket-chat.mongo-url=${ROCKET_CHAT_MONGO_URL:}
rocket.technical.username=${ROCKET_TECHNICAL_USERNAME:}
rocket.technical.password=${ROCKET_TECHNICAL_PASSWORD:}

# ---------------- App Service URLs ----------------
# Use Kubernetes DNS names, e.g., http://agencyservice.caritas.svc.cluster.local:8084/service
# NOT hardcoded IPs or localhost
agency.service.api.url=${AGENCY_SERVICE_API_URL:${app.base.url}/service}
agency.service.api.get.agencies=${agency.service.api.url}/
agency.admin.service.api.url=${AGENCY_ADMIN_SERVICE_API_URL:${app.base.url}}
consulting.type.service.api.url=${CONSULTING_TYPE_SERVICE_API_URL:}
live.service.api.url=${LIVE_SERVICE_API_URL:${app.base.url}/service/liveevent}
appointment.service.api.url=${APPOINTMENT_SERVICE_API_URL:}
tenant.service.api.url=${TENANT_SERVICE_API_URL:}

# ---------------- File import ----------------
consultant.import.filename=consultants.csv
consultant.import.protocol.filename=consultants-import.txt
asker.import.filename=askers.csv
asker.import.withoutsession.filename=askers-without-session.csv
asker.import.protocol.filename=askers-import.txt
asker.import.welcome.message.filename=welcome_consulting_type_[ConsultingType].txt
asker.import.welcome.message.filename.replace.value=[ConsultingType]

# ---------------- Firebase ----------------
firebase.configuration.push-notifications.enabled=false
firebase.configuration.credentials.file.path=/firebase/firebase-credentials.json
firebase.configuration.notification.message=Du hast eine neue Nachricht erhalten

# ---------------- Cache ----------------
cache.agencies.configuration.maxEntriesLocalHeap=100
cache.agencies.configuration.eternal=false
cache.agencies.configuration.timeToIdleSeconds=0
cache.agencies.configuration.timeToLiveSeconds=10800

cache.consulting.type.configuration.maxEntriesLocalHeap=100
cache.consulting.type.configuration.eternal=false
cache.consulting.type.configuration.timeToIdleSeconds=0
cache.consulting.type.configuration.timeToLiveSeconds=86400

cache.tenant.configuration.maxEntriesLocalHeap=100
cache.tenant.configuration.eternal=false
cache.tenant.configuration.timeToIdleSeconds=0
cache.tenant.configuration.timeToLiveSeconds=86400

cache.topic.configuration.maxEntriesLocalHeap=100
cache.topic.configuration.eternal=false
cache.topic.configuration.timeToIdleSeconds=0
cache.topic.configuration.timeToLiveSeconds=60

cache.appsettings.configuration.maxEntriesLocalHeap=100
cache.appsettings.configuration.eternal=false
cache.appsettings.configuration.timeToIdleSeconds=0
cache.appsettings.configuration.timeToLiveSeconds=60

cache.rocketchat.configuration.maxEntriesLocalHeap=100
cache.rocketchat.configuration.eternal=false
cache.rocketchat.configuration.timeToIdleSeconds=0
cache.rocketchat.configuration.timeToLiveSeconds=900

# ---------------- Mail / Messaging ----------------
# Use Kubernetes DNS names, e.g., http://mailservice.caritas.svc.cluster.local:8080/service
mail.service.api.url=${MAIL_SERVICE_API_URL:}
message.service.api.url=${MESSAGE_SERVICE_API_URL:}

# ---------------- Thread / Task Executor ----------------
# Scaled for 5000 concurrent users
thread.executor.corePoolSize=250
thread.executor.maxPoolSize=500
thread.executor.queueCapacity=10000
thread.executor.threadNamePrefix=UserService-

# ---------------- CSRF ----------------
csrf.header.property=X-CSRF-Token
csrf.whitelist.adminUris=/useradmin,/service/useradmin,/service/useradmin/,/service/useradmin/**,/useradmin/tenantadmins,/service/useradmin/tenantadmins,/service/useradmin/tenantadmins/,/service/useradmin/tenantadmins/**
csrf.whitelist.configUris=/users/docs,\
  /users/docs/**,\
  /service/users/sessions/,\
  /users/sessions/,\
  /v3/api-docs/**,\
  /swagger-ui.html,\
  /swagger-ui/**,\
  /actuator/health/**,\
  /actuator/health,\
  /actuator/loggers/**,\
  /actuator/loggers,\
  /webjars/**,\
  /matrix/sync/**,\
  /users/sessions/room,\
  /users/sessions/room/**
csrf.cookie.property=CSRF-TOKEN
csrf.whitelist.header.property=X-CSRF-Bypass

# ---------------- RabbitMQ ----------------
# Use Kubernetes DNS names, e.g., rabbitmq.caritas.svc.cluster.local
# NOT hardcoded IPs like 10.43.157.60
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:}
statistics.enabled=false
statistics.rabbitmq.exchange.name=statistics.topic

# ---------------- Video Chat ----------------
videochat.e2e-encryption-enabled=false

# ---------------- MariaDB ----------------
# Configuration must be provided via ConfigMap/Secrets (environment variables)
# Use Kubernetes DNS names, e.g., jdbc:mariadb://mariadb.caritas.svc.cluster.local:3306/userservice
# NOT hardcoded IPs like jdbc:mariadb://10.43.123.72:3306/userservice
spring.datasource.url=${SPRING_DATASOURCE_URL:}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.hikari.maximum-pool-size=500
spring.datasource.hikari.minimum-idle=250
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.maxLifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDB103Dialect
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.hibernate.ddl-auto=validate

# ---------------- Keycloak ----------------
# Use Kubernetes DNS names, e.g., http://keycloak.caritas.svc.cluster.local:8080
# NOT hardcoded IPs like http://10.43.63.186:8080
keycloak.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:}
keycloak.realm=${KEYCLOAK_REALM:}
keycloak.bearer-only=true
keycloak.resource=app
keycloak.principal-attribute=preferred_username
keycloak.cors=false

# OAuth2 Resource Server (Keycloak as OIDC issuer)
spring.security.oauth2.resourceserver.jwt.issuer-uri=${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI:}

# ---------------- Multitenancy ----------------
multitenancy.enabled=false
spring.jpa.properties.hibernate.ejb.interceptor=de.caritas.cob.userservice.api.service.TenantHibernateInterceptor
hibernate.current_session_context_class=org.hibernate.context.internal.ThreadLocalSessionContext

# ---------------- Appointments & Features ----------------
appointments.delete-job-cron=0 0 0 * * ?
appointments.delete-job-enabled=false
appointments.lifespan-in-hours=24
feature.topics.enabled=false
feature.demographics.enabled=false
feature.appointment.enabled=false
feature.multitenancy.with.single.domain.enabled=false
feature.video.group.chats.enabled=true

# ---------------- Actuator ----------------
management.endpoint.health.enabled=true
management.endpoint.health.show-details=always
management.endpoints.web.exposure.include=health,loggers
management.endpoint.health.probes.enabled=true
management.endpoint.loggers.enabled=true

# ---------------- Distributed Tracing (Micrometer / OTel) ----------------
management.tracing.enabled=false
management.tracing.sampling.probability=1.0
# Zipkin endpoint used by the OTel Zipkin exporter when tracing is enabled
management.zipkin.tracing.endpoint=${MANAGEMENT_ZIPKIN_TRACING_ENDPOINT:}

# ---------------- Local Defaults ----------------
anonymous.username.prefix=anon_

# Matrix Synapse Configuration
# Use Kubernetes DNS names, e.g., http://matrix-synapse.caritas.svc.cluster.local:8008
# NOT hardcoded IPs like http://91.99.219.182:8008
matrix.apiUrl=${MATRIX_API_URL:}
matrix.registrationSharedSecret=${MATRIX_REGISTRATION_SHARED_SECRET:}
matrix.serverName=${MATRIX_SERVER_NAME:}
