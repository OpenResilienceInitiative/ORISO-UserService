# ---------------- Logging ----------------
server.port=8082
logging.level.root=INFO
logging.level.org.springframework.web=DEBUG
logging.level.org.hibernate=ERROR
logging.level.org.springframework.web.servlet.mvc.method.annotation=DEBUG

# ---------------- Keycloak ----------------
keycloak.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:}
keycloak.realm=${KEYCLOAK_REALM:}
keycloak.bearer-only=true
keycloak.resource=app
keycloak.principal-attribute=preferred_username
keycloak.cors=false
keycloak.use-resource-role-mappings=false
keycloak.config.admin-username=${KEYCLOAK_CONFIG_ADMIN_USERNAME:}
keycloak.config.admin-password=${KEYCLOAK_CONFIG_ADMIN_PASSWORD:}
keycloak.config.admin-client-id=admin-cli
keycloak.config.app-client-id=app

# ---------------- MariaDB ----------------
# Scaled for 5000 concurrent users
# Configuration must be provided via ConfigMap/Secrets (environment variables)
# Use Kubernetes DNS names, e.g., jdbc:mariadb://mariadb.caritas.svc.cluster.local:3306/userservice
# NOT hardcoded IPs like jdbc:mariadb://10.43.123.72:3306/userservice
spring.datasource.url=${SPRING_DATASOURCE_URL:}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.hikari.maximum-pool-size=500
spring.datasource.hikari.minimum-idle=250
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.maxLifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDB103Dialect
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.hibernate.ddl-auto=validate

# ---------------- Rocket.Chat ----------------
rocket.technical.username=${ROCKET_TECHNICAL_USERNAME:}
rocket.technical.password=${ROCKET_TECHNICAL_PASSWORD:}
rocket.systemuser.id=${ROCKET_SYSTEMUSER_ID:}
rocket.systemuser.username=${ROCKET_SYSTEMUSER_USERNAME:}
rocket.systemuser.password=${ROCKET_SYSTEMUSER_PASSWORD:}
rocket-chat.credential-cron=0 */10 * * * ?
rocket-chat.base-url=${ROCKET_CHAT_BASE_URL:}
rocket-chat.mongo-url=${ROCKET_CHAT_MONGO_URL:}

# ---------------- Liquibase ----------------
spring.liquibase.enabled=false
# Database already exists, skip Liquibase migration

# ---------------- Local App Settings ----------------
app.base.url=${APP_BASE_URL:http://localhost:8082}
multitenancy.enabled=false

# ---------------- Agency Service URL ----------------
agency.service.api.url=${AGENCY_SERVICE_API_URL:}

# ---------------- CSRF (match admin app) ----------------
csrf.header.property=X-CSRF-Token
csrf.cookie.property=CSRF-TOKEN
csrf.whitelist.header.property=X-CSRF-Token
csrf.whitelist.config-uris=/users/data,\
  /users/sessions/askers,\
  /service/users/sessions/,\
  /users/sessions/,\
  /actuator/health,\
  /actuator/health/**,\
  /actuator/loggers,\
  /actuator/loggers/**
tenant.service.api.url=${TENANT_SERVICE_API_URL:}

# ---------------- Spring Boot MongoDB connection ----------------
# Use Kubernetes DNS names, e.g., mongodb://mongodb.caritas.svc.cluster.local:27017/userservice
# NOT hardcoded IPs like mongodb://10.43.61.124:27017/userservice
spring.data.mongodb.uri=${SPRING_DATA_MONGODB_URI:}
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:}
keycloak.ssl-required=none
